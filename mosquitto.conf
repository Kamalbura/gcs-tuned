# UAVPI Mosquitto mTLS configuration
listener 8883

# Certificates generated by tools/pki/generate-pki.ps1 -> certs/
cafile   "C:\mqtt\certs\ca-cert.pem"
certfile "C:\mqtt\certs\server-cert.pem"
keyfile  "C:\mqtt\certs\server-key.pem"

# Require client certificates (mTLS)
require_certificate true
use_identity_as_username true
allow_anonymous false

tls_version tlsv1.2

# ACL for topic-level permissions
acl_file "C:\mqtt\acl\swarm_acl.conf"

# Persistence and logging
persistence true
persistence_location "C:\\mqtt\\data\\"
log_type all
log_dest file "C:\mqtt\logs\mosquitto.log"
log_type error
log_type warning
log_type notice
log_type information
# log_type debug            # uncomment for verbose troubleshooting

# Notes:
# - The CN from each client certificate becomes the MQTT username due to use_identity_as_username.
# - Ensure the files referenced above exist before launching Mosquitto.
# - Paths are absolute to avoid working-directory issues on Windows.
